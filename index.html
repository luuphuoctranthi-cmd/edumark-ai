<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EduMark AI - Ch·∫•m b√†i, Nh·∫≠n x√©t v√† Chia s·∫ª</title>
  <!-- T·∫£i Tailwind CSS ƒë·ªÉ t·∫°o giao di·ªán ƒë·∫πp v√† t∆∞∆°ng th√≠ch di ƒë·ªông -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- T·∫£i Babel ƒë·ªÉ x·ª≠ l√Ω JSX trong tr√¨nh duy·ªát -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- T·∫£i React v√† ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- T·∫£i KaTeX ƒë·ªÉ hi·ªÉn th·ªã c√¥ng th·ª©c to√°n h·ªçc -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" xintegrity="sha384-n8MVd4RsNIU0KOVEMGmONpbMBiZBHIhhpjHQL/TCpAaVvIFKcuYoVfI4dB2Ddiea" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>

</head>
<body class="bg-gray-100 font-sans">

  <div id="root"></div>

  <script type="text/babel">
    'use strict';

    // H√†m chuy·ªÉn ƒë·ªïi file sang base64 ƒë·ªÉ hi·ªÉn th·ªã preview v√† nh√∫ng v√†o PDF
    const fileToBase64 = (file) => {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result); // Gi·ªØ nguy√™n data URL ƒë·∫ßy ƒë·ªß
        reader.onerror = (error) => reject(error);
      });
    };
    
    // H√†m chuy·ªÉn ƒë·ªïi file sang base64 ch·ªâ l·∫•y ph·∫ßn d·ªØ li·ªáu ƒë·ªÉ g·ª≠i cho API
    const fileToBase64ForApi = (file) => {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]); // Ch·ªâ l·∫•y ph·∫ßn d·ªØ li·ªáu sau d·∫•u ph·∫©y
        reader.onerror = (error) => reject(error);
      });
    };

    // API key ƒë√£ ƒë∆∞·ª£c cung c·∫•p
    const API_KEY = "AIzaSyALu1blNRFIB5VdwHeEzz0PWycaJZ5eONc";

    // Ph·∫£n h·ªìi m·∫´u chi ti·∫øt khi kh√¥ng c√≥ API Key, ph√π h·ª£p nhi·ªÅu m√¥n h·ªçc
    const getSampleResponse = () => {
        return `
### Ch·∫•m ƒëi·ªÉm
8.0/10

### Nh·∫≠n x√©t
**∆Øu ƒëi·ªÉm:**
- B√†i l√†m c√≥ b·ªë c·ª•c r√µ r√†ng, lu·∫≠n ƒëi·ªÉm m·∫°ch l·∫°c.
- Di·ªÖn ƒë·∫°t tr√¥i ch·∫£y, s·ª≠ d·ª•ng t·ª´ ng·ªØ phong ph√∫.

**H·∫°n ch·∫ø:**
- Ph·∫ßn d·∫´n ch·ª©ng c√≤n ch∆∞a th·ª±c s·ª± thuy·∫øt ph·ª•c, thi·∫øu s·ªë li·ªáu ho·∫∑c v√≠ d·ª• c·ª• th·ªÉ.
- K·∫øt lu·∫≠n h∆°i v·ªôi v√†ng, ch∆∞a t√≥m l∆∞·ª£c ƒë∆∞·ª£c h·∫øt c√°c √Ω ƒë√£ tr√¨nh b√†y.

**ƒê·ªãnh h∆∞·ªõng ph√°t tri·ªÉn nƒÉng l·ª±c:**
- **NƒÉng l·ª±c t∆∞ duy ph·∫£n bi·ªán:** C·∫ßn r√®n luy·ªán c√°ch t√¨m ki·∫øm v√† ƒë√°nh gi√° c√°c ngu·ªìn th√¥ng tin ƒë·ªÉ ƒë∆∞a ra d·∫´n ch·ª©ng x√°c ƒë√°ng.
- **NƒÉng l·ª±c l·∫≠p lu·∫≠n:** C·∫ßn c·ªßng c·ªë k·ªπ nƒÉng t·ªïng h·ª£p th√¥ng tin ƒë·ªÉ vi·∫øt ph·∫ßn k·∫øt lu·∫≠n s√∫c t√≠ch v√† bao qu√°t h∆°n.

### G·ª£i √Ω C·∫£i thi·ªán
1.  **Th√™m d·∫´n ch·ª©ng c·ª• th·ªÉ:** V·ªõi m·ªói lu·∫≠n ƒëi·ªÉm, h√£y t√¨m √≠t nh·∫•t m·ªôt v√≠ d·ª•, m·ªôt s·ªë li·ªáu, ho·∫∑c m·ªôt tr√≠ch d·∫´n t·ª´ ngu·ªìn uy t√≠n ƒë·ªÉ minh h·ªça.
2.  **Vi·∫øt l·∫°i ph·∫ßn k·∫øt lu·∫≠n:** Sau khi vi·∫øt xong th√¢n b√†i, h√£y ƒë·ªçc l·∫°i v√† g·∫°ch ra c√°c √Ω ch√≠nh. D·ª±a v√†o ƒë√≥ ƒë·ªÉ vi·∫øt m·ªôt ƒëo·∫°n k·∫øt lu·∫≠n m·ªõi, t√≥m t·∫Øt l·∫°i c√°c lu·∫≠n ƒëi·ªÉm v√† kh·∫≥ng ƒë·ªãnh l·∫°i v·∫•n ƒë·ªÅ.

### B√†i t·∫≠p T∆∞∆°ng t·ª±
1.  Ph√¢n t√≠ch m·ªôt v·∫•n ƒë·ªÅ x√£ h·ªôi b·∫°n quan t√¢m, s·ª≠ d·ª•ng √≠t nh·∫•t 3 ngu·ªìn d·∫´n ch·ª©ng ƒë√°ng tin c·∫≠y.
2.  Vi·∫øt m·ªôt ƒëo·∫°n vƒÉn ng·∫Øn t√≥m t·∫Øt n·ªôi dung c·ªßa m·ªôt b√†i b√°o ho·∫∑c m·ªôt ch∆∞∆°ng s√°ch b·∫°n v·ª´a ƒë·ªçc.
3.  Ch·ªçn m·ªôt c√¢u danh ng√¥n b·∫°n t√¢m ƒë·∫Øc v√† vi·∫øt m·ªôt b√†i vƒÉn ngh·ªã lu·∫≠n v·ªÅ √Ω nghƒ©a c·ªßa c√¢u n√≥i ƒë√≥.
        `;
    };


    // H√†m g·ªçi Gemini API
    async function callGeminiAPI(prompt, imageDatas = []) {
      if (!API_KEY) {
          console.log("ƒêang b·ªè qua cu·ªôc g·ªçi API v√¨ kh√¥ng c√≥ API Key. S·ª≠ d·ª•ng vƒÉn b·∫£n m·∫´u chi ti·∫øt.");
          return getSampleResponse();
      }
      const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
      const headers = { 'Content-Type': 'application/json' };
      
      const parts = [{ text: prompt }];
      if (imageDatas.length > 0) {
        imageDatas.forEach(imageData => {
            parts.push({
                inlineData: { mimeType: "image/png", data: imageData }
            });
        });
      }
      
      const payload = { contents: [{ role: 'user', parts: parts }] };
      
      try {
        const response = await fetch(url, { method: 'POST', headers: headers, body: JSON.stringify(payload) });
        if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
        const result = await response.json();
        if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
          return result.candidates[0].content.parts[0].text;
        } else {
          console.error("L·ªói: C·∫•u tr√∫c ph·∫£n h·ªìi API kh√¥ng h·ª£p l·ªá.", result);
          return "Kh√¥ng th·ªÉ nh·∫≠n ƒë∆∞·ª£c ph·∫£n h·ªìi t·ª´ AI. Vui l√≤ng th·ª≠ l·∫°i.";
        }
      } catch (error) {
        console.error("L·ªói khi g·ªçi Gemini API:", error);
        return `ƒê√£ x·∫£y ra l·ªói: ${error.message}. Vui l√≤ng th·ª≠ l·∫°i sau.`;
      }
    }
    
    // Component ƒë·ªÉ hi·ªÉn th·ªã n·ªôi dung c√≥ c√¥ng th·ª©c to√°n
    const MathContent = ({ text }) => {
        const contentRef = React.useRef(null);
        React.useEffect(() => {
            if (contentRef.current && text && window.renderMathInElement) {
                // Thay th·∫ø \n b·∫±ng <br> ƒë·ªÉ xu·ªëng d√≤ng trong HTML
                contentRef.current.innerHTML = text.replace(/\n/g, '<br />');
                window.renderMathInElement(contentRef.current, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                    ],
                    throwOnError: false
                });
            } else if (contentRef.current) {
                contentRef.current.innerHTML = text.replace(/\n/g, '<br />');
            }
        }, [text]);

        if (!text) return null;
        
        return <div ref={contentRef} className="text-gray-700 leading-relaxed"></div>;
    };


    const App = () => {
      const [text, setText] = React.useState('');
      const [files, setFiles] = React.useState([]);
      const [filePreviews, setFilePreviews] = React.useState([]);
      const [grade, setGrade] = React.useState('L·ªõp 12');
      const [score, setScore] = React.useState('');
      const [feedback, setFeedback] = React.useState('');
      const [suggestion, setSuggestion] = React.useState('');
      const [similarExercises, setSimilarExercises] = React.useState('');
      const [isLoading, setIsLoading] = React.useState(false);
      const [isJsPdfLoaded, setIsJsPdfLoaded] = React.useState(false);
      const [copied, setCopied] = React.useState(false);
      const [apiKeyMissing] = React.useState(!API_KEY);
      const [shareUrl, setShareUrl] = React.useState('');

      React.useEffect(() => {
        const script = document.createElement('script');
        script.src = "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";
        script.async = true;
        script.onload = () => setIsJsPdfLoaded(true);
        script.onerror = () => console.error("L·ªói khi t·∫£i jsPDF.");
        document.body.appendChild(script);

        try {
            const params = new URLSearchParams(window.location.search);
            const data = params.get('data');
            if (data) {
                const decodedData = JSON.parse(atob(data));
                setText(decodedData.text || '');
                setGrade(decodedData.grade || 'L·ªõp 12');
                setScore(decodedData.score || '');
                setFeedback(decodedData.feedback || '');
                setSuggestion(decodedData.suggestion || '');
                setSimilarExercises(decodedData.similarExercises || '');
            }
        } catch (error) {
            console.error("Kh√¥ng th·ªÉ ƒë·ªçc d·ªØ li·ªáu t·ª´ link chia s·∫ª:", error);
        }

        return () => { document.body.removeChild(script); };
      }, []);

      const getPromptContent = async () => {
        if (files.length > 0) {
          try {
            const imagePromises = files.map(file => fileToBase64ForApi(file));
            const imageDatas = await Promise.all(imagePromises);
            return { imageDatas: imageDatas, textContent: text };
          } catch (error) {
            setFeedback("L·ªói khi x·ª≠ l√Ω h√¨nh ·∫£nh. Vui l√≤ng th·ª≠ l·∫°i.");
            return { imageDatas: null, textContent: null };
          }
        } else if (text) {
          return { imageDatas: [], textContent: text };
        }
        setFeedback("Vui l√≤ng nh·∫≠p vƒÉn b·∫£n ho·∫∑c t·∫£i ·∫£nh b√†i l√†m.");
        return { imageDatas: null, textContent: null };
      };
      
      const handleComprehensiveGrade = async () => {
        setIsLoading(true);
        setScore(''); setFeedback(''); setSuggestion(''); setSimilarExercises('');
        
        const { imageDatas, textContent } = await getPromptContent();
        if ((!imageDatas || imageDatas.length === 0) && !textContent) { setIsLoading(false); return; }

        const prompt = `B·∫°n l√† m·ªôt gi√°o vi√™n ${grade} t·∫≠n t√¢m. D·ª±a v√†o n·ªôi dung b√†i l√†m c·ªßa h·ªçc sinh, h√£y t·ª± x√°c ƒë·ªãnh m√¥n h·ªçc v√† ƒë∆∞a ra ph·∫£n h·ªìi to√†n di·ªán, ph√π h·ª£p v·ªõi tr√¨nh ƒë·ªô c·ªßa ${grade}.
        Quan tr·ªçng: N·∫øu l√† m√¥n To√°n, L√Ω, H√≥a, h√£y s·ª≠ d·ª•ng c√∫ ph√°p LaTeX cho T·∫§T C·∫¢ c√°c c√¥ng th·ª©c (v√≠ d·ª•: d√πng $ \\frac{1}{2} $ thay v√¨ 1/2).
        H√£y tr·∫£ l·ªùi theo ƒë√∫ng c·∫•u tr√∫c 4 ph·∫ßn sau, s·ª≠ d·ª•ng Markdown heading:

        ### Ch·∫•m ƒëi·ªÉm
        (Ghi ƒëi·ªÉm s·ªë c·ªßa b√†i l√†m tr√™n thang ƒëi·ªÉm 10, v√≠ d·ª•: 8.5/10)

        ### Nh·∫≠n x√©t
        (Ph√¢n t√≠ch ∆∞u ƒëi·ªÉm, h·∫°n ch·∫ø, v√† ƒë·ªãnh h∆∞·ªõng ph√°t tri·ªÉn nƒÉng l·ª±c ph√π h·ª£p v·ªõi l·ª©a tu·ªïi ${grade}: t√≠nh to√°n, gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ, t∆∞ duy logic, l·∫≠p lu·∫≠n, s√°ng t·∫°o...)

        ### G·ª£i √Ω C·∫£i thi·ªán
        (ƒê∆∞a ra 2-3 g·ª£i √Ω c·ª• th·ªÉ, c√≥ th·ªÉ h√†nh ƒë·ªông ngay ƒë·ªÉ kh·∫Øc ph·ª•c l·ªói sai, ng√¥n ng·ªØ v√† ƒë·ªô kh√≥ ph√π h·ª£p v·ªõi ${grade})

        ### B√†i t·∫≠p T∆∞∆°ng t·ª±
        (ƒê∆∞a ra 2-3 b√†i t·∫≠p ho·∫∑c c√¢u h·ªèi c√≥ d·∫°ng t∆∞∆°ng t·ª± ƒë·ªÉ h·ªçc sinh luy·ªán t·∫≠p th√™m, ph√π h·ª£p v·ªõi ch∆∞∆°ng tr√¨nh h·ªçc c·ªßa ${grade})
        `;

        const fullPrompt = `${prompt}\n\nB√†i l√†m c·ªßa h·ªçc sinh:\n"""\n${textContent || 'H·ªçc sinh n·ªôp b√†i b·∫±ng h√¨nh ·∫£nh.'}\n"""`;
        const result = await callGeminiAPI(fullPrompt, imageDatas);

        const scorePart = result.split('### Nh·∫≠n x√©t')[0].replace('### Ch·∫•m ƒëi·ªÉm', '').trim();
        const feedbackPart = result.split('### Nh·∫≠n x√©t')[1]?.split('### G·ª£i √Ω C·∫£i thi·ªán')[0].trim();
        const suggestionPart = result.split('### G·ª£i √Ω C·∫£i thi·ªán')[1]?.split('### B√†i t·∫≠p T∆∞∆°ng t·ª±')[0].trim();
        const exercisesPart = result.split('### B√†i t·∫≠p T∆∞∆°ng t·ª±')[1]?.trim();

        setScore(scorePart || "Ch∆∞a c√≥ ƒëi·ªÉm");
        setFeedback(feedbackPart || "Kh√¥ng c√≥ nh·∫≠n x√©t.");
        setSuggestion(suggestionPart || "Kh√¥ng c√≥ g·ª£i √Ω n√†o.");
        setSimilarExercises(exercisesPart || "Kh√¥ng c√≥ b√†i t·∫≠p t∆∞∆°ng t·ª±.");
        
        setIsLoading(false);
      };

      const handleFileChange = (e) => {
        if (e.target.files.length > 0) {
            const selectedFiles = Array.from(e.target.files);
            setFiles(selectedFiles);

            const filePromises = selectedFiles.map(file => fileToBase64(file));
            Promise.all(filePromises)
                .then(base64Files => { setFilePreviews(base64Files); })
                .catch(error => { console.error("L·ªói khi t·∫°o preview ·∫£nh:", error); });
        }
      };
      
      const handleDownloadFeedback = () => {
        if (isJsPdfLoaded && window.jspdf) {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();
          doc.addFont('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/fonts/Roboto/Roboto-Regular.ttf', 'Roboto', 'normal');
          doc.setFont('Roboto');
          let y = 20;
          const addText = (text, startY) => {
              if (!text) return startY;
              const lines = doc.splitTextToSize(text.replace(/(\*\*|###)/g, ''), 180);
              doc.text(lines, 10, startY);
              return startY + (lines.length * 6);
          }
          doc.text("PHI·∫æU CH·∫§M B√ÄI - EDUMARK AI", 105, 15, null, null, 'center');
          y = addText(`Kh·ªëi l·ªõp: ${grade}`, y+5);
          y = addText(`ƒêi·ªÉm s·ªë: ${score}`, y);
          y = addText(`\nN·ªôi dung b√†i l√†m (n·∫øu c√≥):\n${text}`, y);
          y = addText(`\n\nNh·∫≠n x√©t:\n${feedback}`, y);
          y = addText(`\n\nG·ª£i √Ω c·∫£i thi·ªán:\n${suggestion}`, y);
          y = addText(`\n\nB√†i t·∫≠p t∆∞∆°ng t·ª±:\n${similarExercises}`, y);

          if (filePreviews.length > 0) {
              filePreviews.forEach((imgData, index) => {
                  doc.addPage();
                  doc.text(`H√¨nh ·∫£nh b√†i l√†m c·ªßa h·ªçc sinh (${index + 1}/${filePreviews.length})`, 10, 15);
                  try {
                    const imgProps = doc.getImageProperties(imgData);
                    const pdfWidth = doc.internal.pageSize.getWidth();
                    const pageMargin = 20;
                    const imgWidth = pdfWidth - (pageMargin * 2);
                    const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
                    let imgY = 25;
                    doc.addImage(imgData, 'PNG', pageMargin, imgY, imgWidth, imgHeight);
                  } catch(e) {
                    console.error("L·ªói khi th√™m ·∫£nh v√†o PDF:", e);
                    doc.text("Kh√¥ng th·ªÉ hi·ªÉn th·ªã h√¨nh ·∫£nh n√†y.", 10, 25);
                  }
              });
          }
          
          doc.save('Phieu-cham-bai-EduMark-AI.pdf');
        } else {
          alert("L·ªói: Th∆∞ vi·ªán t·∫°o PDF ch∆∞a t·∫£i xong. Vui l√≤ng th·ª≠ l·∫°i sau gi√¢y l√°t.");
        }
      };

      const handleShare = () => {
          const dataToShare = { text, grade, score, feedback, suggestion, similarExercises };
          const encodedData = btoa(JSON.stringify(dataToShare));
          const baseUrl = window.location.href.split('?')[0];
          const url = `${baseUrl}?data=${encodedData}`;

          setShareUrl(url); // Lu√¥n hi·ªÉn th·ªã link ƒë·ªÉ ng∆∞·ªùi d√πng c√≥ th·ªÉ sao ch√©p th·ªß c√¥ng

          const textArea = document.createElement("textarea");
          textArea.value = url;
          textArea.style.position = "fixed";
          textArea.style.top = "-9999px"; // Di chuy·ªÉn ra ngo√†i m√†n h√¨nh
          textArea.style.left = "-9999px";

          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();

          let successful = false;
          try { successful = document.execCommand('copy'); } 
          catch (err) { successful = false; }
          document.body.removeChild(textArea);

          if (successful) {
              setCopied(true);
              setTimeout(() => {
                  setCopied(false);
                  setShareUrl(''); // X√≥a URL sau khi sao ch√©p t·ª± ƒë·ªông th√†nh c√¥ng
              }, 2000);
          }
      };


      return (
        <div className="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4">
          <div className="w-full max-w-2xl bg-white rounded-xl shadow-2xl p-6 md:p-8 space-y-6">
            <div className="w-24 h-24 mx-auto mb-2">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="aiLogoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style={{stopColor: '#38bdf8'}} />
                            <stop offset="100%" style={{stopColor: '#a78bfa'}} />
                        </linearGradient>
                    </defs>
                    <path fill="url(#aiLogoGradient)" d="M17.82,2.09c-0.34-0.1-0.7-0.03-0.97,0.2c-0.69,0.59-0.62,1.69,0.14,2.15c2.39,1.44,4.02,3.95,4.02,6.56 c0,4.41-3.59,8-8,8s-8-3.59-8-8c0-2.61,1.63-5.12,4.02-6.56c0.76-0.46,0.84-1.56,0.14-2.15c-0.27-0.23-0.62-0.3-0.97-0.2 c-3.34,1-5.99,4.09-5.99,7.91c0,4.97,4.03,9,9,9s9-4.03,9-9C23.81,6.18,21.16,3.09,17.82,2.09z M12,14c-1.66,0-3-1.34-3-3s1.34-3,3-3 s3,1.34,3,3S13.66,14,12,14z M12,10c-0.55,0-1,0.45-1,1s0.45,1,1,1s1-0.45,1-1S12.55,10,12,10z"/>
                </svg>
            </div>
            <h1 className="text-3xl md:text-4xl font-extrabold text-center tracking-tight bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent">EduMark AI</h1>
            <p className="text-center text-blue-600 font-semibold text-xs md:text-sm -mt-2 italic">
                T√°c gi·∫£: Tr·∫ßn Th·ªã L∆∞u Ph∆∞·ªõc - Tr∆∞·ªùng TiH L√™ VƒÉn T√°m - P.T√¢n M·ªπ - TP.HCM
            </p>

            <textarea
              className="w-full h-40 md:h-52 p-4 text-gray-800 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-4 focus:ring-blue-500 focus:border-blue-500"
              placeholder="D√°n ho·∫∑c nh·∫≠p vƒÉn b·∫£n b√†i l√†m c·ªßa h·ªçc sinh v√†o ƒë√¢y..."
              value={text}
              onChange={(e) => setText(e.target.value)}
            />
            
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 items-center">
                <div className="w-full">
                    <label htmlFor="grade-select" className="block text-sm font-medium text-gray-700 mb-1">Ch·ªçn kh·ªëi l·ªõp:</label>
                    <select
                        id="grade-select"
                        value={grade}
                        onChange={(e) => setGrade(e.target.value)}
                        className="w-full p-3 border-2 border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        {Array.from({ length: 12 }, (_, i) => i + 1).map(g => (
                        <option key={g} value={`L·ªõp ${g}`}>{`L·ªõp ${g}`}</option>
                        ))}
                    </select>
                </div>
                <label htmlFor="file-upload" className="w-full px-6 py-3 text-center text-white font-bold bg-green-500 rounded-full shadow-lg hover:bg-green-600 transition-all cursor-pointer mt-6 sm:mt-0">
                    <input id="file-upload" type="file" accept="image/*" className="hidden" multiple onChange={handleFileChange} />
                    {files.length > 0 ? `ƒê√£ ch·ªçn: ${files.length} ·∫£nh` : "T·∫£i ·∫£nh b√†i l√†m"}
                </label>
            </div>

            <div className="border-t pt-6">
              <button
                onClick={handleComprehensiveGrade}
                disabled={isLoading}
                className="w-full px-6 py-4 text-white font-bold bg-blue-600 rounded-full shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all disabled:bg-gray-400 flex items-center justify-center text-lg"
              >
                {isLoading ? (
                    <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                ) : '‚ú® Ch·∫•m & Ph·∫£n h·ªìi To√†n di·ªán ‚ú®'}
              </button>
            </div>

            <div className="flex flex-col md:flex-row items-center justify-center gap-4 pt-4 border-t">
               <button onClick={handleShare} className="w-full md:w-auto px-8 py-3 text-white font-bold bg-teal-500 rounded-full shadow-lg hover:bg-teal-600">
                {copied ? '‚úÖ ƒê√£ sao ch√©p!' : 'üîó T·∫°o & Sao ch√©p Link'}
              </button>
              <button onClick={handleDownloadFeedback} className="w-full md:w-auto px-8 py-3 text-white font-bold bg-gray-500 rounded-full shadow-lg hover:bg-gray-600">
                üì• T·∫£i Phi·∫øu Ch·∫•m B√†i
              </button>
            </div>

            {shareUrl && !copied && (
                <div className="mt-4 p-4 bg-red-50 border border-red-200 rounded-lg">
                    <p className="text-sm font-semibold text-red-700">Kh√¥ng th·ªÉ t·ª± ƒë·ªông sao ch√©p!</p>
                    <p className="text-xs text-red-600 mb-2">Vui l√≤ng sao ch√©p link d∆∞·ªõi ƒë√¢y theo c√°ch th·ªß c√¥ng:</p>
                    <input 
                        type="text" 
                        readOnly 
                        value={shareUrl} 
                        className="w-full p-2 text-xs border rounded bg-gray-100 text-gray-700 focus:outline-none focus:ring-2 focus:ring-red-300" 
                        onFocus={e => e.target.select()} 
                    />
                </div>
            )}

            {/* Khu v·ª±c hi·ªÉn th·ªã k·∫øt qu·∫£ */}
            {apiKeyMissing && !isLoading && (score || feedback) && (
                <div className="mt-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 rounded-lg" role="alert">
                    <p className="font-bold">L∆∞u √Ω: ƒê√¢y l√† ph·∫£n h·ªìi m·∫´u</p>
                    <p>Do API Key ch∆∞a ƒë∆∞·ª£c cung c·∫•p, ·ª©ng d·ª•ng ch·ªâ hi·ªÉn th·ªã d·ªØ li·ªáu v√≠ d·ª•. Khi c√≥ API Key, nh·∫≠n x√©t s·∫Ω thay ƒë·ªïi theo t·ª´ng b√†i l√†m.</p>
                </div>
            )}

            {score && (
              <div className="mt-6 p-6 md:p-8 bg-yellow-50 rounded-lg shadow-inner border-l-4 border-yellow-400 text-center">
                <h2 className="text-2xl font-bold text-gray-800 mb-2">ƒêi·ªÉm s·ªë</h2>
                <p className="text-4xl font-bold text-yellow-600">{score}</p>
              </div>
            )}
            {feedback && (
              <div className="mt-6 p-6 md:p-8 bg-blue-50 rounded-lg shadow-inner border-l-4 border-blue-400">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Nh·∫≠n x√©t</h2>
                <MathContent text={feedback} />
              </div>
            )}
            {suggestion && (
              <div className="mt-6 p-6 md:p-8 bg-purple-50 rounded-lg shadow-inner border-l-4 border-purple-400">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">G·ª£i √Ω C·∫£i thi·ªán</h2>
                 <MathContent text={suggestion} />
              </div>
            )}
            {similarExercises && (
              <div className="mt-6 p-6 md:p-8 bg-orange-50 rounded-lg shadow-inner border-l-4 border-orange-400">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">B√†i t·∫≠p T∆∞∆°ng t·ª±</h2>
                 <MathContent text={similarExercises} />
              </div>
            )}
          </div>
        </div>
      );
    };

    const container = document.getElementById('root');
    const root = ReactDOM.createRoot(container);
    root.render(<App />);
  </script>

</body>
</html>
